<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Boongsu Gallery with Firebase</title>
<style>
  /* N·ªÅn h·ªìng gradient, font d·ªÖ th∆∞∆°ng */
  body {
    background: linear-gradient(135deg, #ff99cc, #ff3399);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: white;
    text-align: center;
    margin: 0; padding: 20px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  h1 {
    font-size: 3rem;
    margin-bottom: 10px;
  }
  #login-form, #gallery, #upload-section {
    max-width: 600px;
    margin: 10px auto;
    padding: 15px;
    background: #ff4da6cc;
    border-radius: 20px;
    box-shadow: 0 0 30px #ff1a75cc;
  }
  input, button {
    padding: 10px;
    font-size: 1.2rem;
    margin: 5px;
    border-radius: 12px;
    border: none;
  }
  button {
    cursor: pointer;
    background-color: #ff0066;
    color: white;
    font-weight: bold;
  }
  button:hover {
    background-color: #cc0052;
  }
  #gallery {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
  }
  .media-item {
    position: relative;
    margin: 10px;
  }
  .media-item img, .media-item video {
    max-width: 250px;
    max-height: 160px;
    border-radius: 15px;
    box-shadow: 0 0 15px #ff4da6aa;
    object-fit: cover;
  }
  .delete-btn {
    position: absolute;
    top: 6px;
    right: 6px;
    background: #ff4d6dcc;
    border: none;
    border-radius: 50%;
    color: white;
    font-weight: 900;
    font-size: 18px;
    width: 28px;
    height: 28px;
    cursor: pointer;
    opacity: 0.85;
    z-index: 10;
  }
  #logout-btn {
    margin-top: 15px;
    background-color: #cc0033;
  }
  #logout-btn:hover {
    background-color: #990022;
  }
  #login-msg, #upload-msg {
    margin-top: 10px;
    font-weight: bold;
  }
</style>
</head>
<body>

<h1>B·ªëng ∆°i, anh y√™u em nhi·ªÅu l·∫Øm üíñ</h1>

<div id="login-form">
  <h2>ƒêƒÉng nh·∫≠p</h2>
  <input type="email" id="email" placeholder="Email" /><br/>
  <input type="password" id="password" placeholder="M·∫≠t kh·∫©u" /><br/>
  <button onclick="login()">ƒêƒÉng nh·∫≠p</button>
  <button onclick="signup()">ƒêƒÉng k√Ω</button>
  <p id="login-msg"></p>
</div>

<div id="upload-section" style="display:none;">
  <h2>Upload ·∫£nh/video m·ªõi</h2>
  <input type="file" id="fileInput" multiple accept="image/*,video/*" /><br/>
  <button onclick="uploadFiles()">Upload</button>
  <button id="logout-btn" onclick="logout()">ƒêƒÉng xu·∫•t</button>
  <p id="upload-msg"></p>
</div>

<div id="gallery"></div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
// Thay b·∫±ng config Firebase c·ªßa b·∫°n b√™n d∆∞·ªõi nh√©:
const firebaseConfig = {
  apiKey: "YOUR_API_KEY_HERE",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

// Kh·ªüi t·∫°o Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const storage = firebase.storage();
const db = firebase.firestore();

const loginForm = document.getElementById('login-form');
const uploadSection = document.getElementById('upload-section');
const gallery = document.getElementById('gallery');
const loginMsg = document.getElementById('login-msg');
const uploadMsg = document.getElementById('upload-msg');

auth.onAuthStateChanged(user => {
  if(user) {
    loginForm.style.display = 'none';
    uploadSection.style.display = 'block';
    loadGallery(user.uid);
  } else {
    loginForm.style.display = 'block';
    uploadSection.style.display = 'none';
    gallery.innerHTML = '';
  }
});

// ƒêƒÉng nh·∫≠p
function login() {
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;
  loginMsg.textContent = '';
  if(!email || !password) {
    loginMsg.textContent = 'Vui l√≤ng nh·∫≠p email v√† m·∫≠t kh·∫©u!';
    return;
  }
  auth.signInWithEmailAndPassword(email, password)
  .catch(e => {
    loginMsg.textContent = 'L·ªói ƒëƒÉng nh·∫≠p: ' + e.message;
  });
}

// ƒêƒÉng k√Ω
function signup() {
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;
  loginMsg.textContent = '';
  if(!email || !password) {
    loginMsg.textContent = 'Vui l√≤ng nh·∫≠p email v√† m·∫≠t kh·∫©u!';
    return;
  }
  auth.createUserWithEmailAndPassword(email, password)
  .catch(e => {
    loginMsg.textContent = 'L·ªói ƒëƒÉng k√Ω: ' + e.message;
  });
}

// ƒêƒÉng xu·∫•t
function logout() {
  auth.signOut();
}

// Upload file
async function uploadFiles() {
  const files = document.getElementById('fileInput').files;
  if(files.length === 0) {
    uploadMsg.textContent = 'B·∫°n ch∆∞a ch·ªçn file!';
    return;
  }
  uploadMsg.textContent = 'ƒêang upload...';
  const user = auth.currentUser;
  for(let file of files) {
    const storageRef = storage.ref().child(`gallery/${user.uid}/${Date.now()}_${file.name}`);
    try {
      await storageRef.put(file);
      const url = await storageRef.getDownloadURL();
      // L∆∞u metadata v√†o Firestore
      await db.collection('gallery').add({
        uid: user.uid,
        url: url,
        name: file.name,
        type: file.type,
        timestamp: Date.now()
      });
    } catch(e) {
      uploadMsg.textContent = 'L·ªói upload: ' + e.message;
      return;
    }
  }
  uploadMsg.textContent = 'Upload xong!';
  document.getElementById('fileInput').value = '';
  loadGallery(user.uid);
}

// Load gallery c·ªßa user
async function loadGallery(uid) {
  gallery.innerHTML = '<p>ƒêang t·∫£i ·∫£nh/video...</p>';
  try {
    const snapshot = await db.collection('gallery')
      .where('uid', '==', uid)
      .orderBy('timestamp', 'desc')
      .get();
    if(snapshot.empty) {
      gallery.innerHTML = '<p>Ch∆∞a c√≥ ·∫£nh/video n√†o.</p>';
      return;
    }
    gallery.innerHTML = '';
    snapshot.forEach(doc => {
      const data = doc.data();
      const mediaDiv = document.createElement('div');
      mediaDiv.className = 'media-item';

      let mediaElement;
      if(data.type.startsWith('image/')) {
        mediaElement = document.createElement('img');
        mediaElement.src = data.url;
        mediaElement.alt = data.name;
      } else if(data.type.startsWith('video/')) {
        mediaElement = document.createElement('video');
        mediaElement.controls = true;
        const source = document.createElement('source');
        source.src = data.url;
        source.type = data.type;
        mediaElement.appendChild(source);
      }

      mediaDiv.appendChild(mediaElement);

      // N√∫t x√≥a
      const delBtn = document.createElement('button');
      delBtn.className = 'delete-btn';
      delBtn.textContent = '‚ùå';
      delBtn.onclick = async () => {
        if(confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ·∫£nh/video n√†y kh√¥ng?')) {
          try {
            const fileRef = storage.refFromURL(data.url);
            await fileRef.delete();
            await db.collection('gallery').doc(doc.id).delete();
            mediaDiv.remove();
          } catch(e) {
            alert('L·ªói x√≥a: ' + e.message);
          }
        }
      };
      mediaDiv.appendChild(delBtn);

      gallery.appendChild(mediaDiv);
    });
  } catch(e) {
    gallery.innerHTML = '<p>L·ªói t·∫£i gallery: ' + e.message + '</p>';
  }
}
</script>

</body>
</html>
